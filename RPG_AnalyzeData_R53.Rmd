---
title: "Analyse descriptive du mix cultural de la Bretagne (2007-2023)"
author: "Aziliz Joseph dit Pagny, Inès Bezie et Loïc Henry"
date: "2025-06-12"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning = FALSE)
```

```{r environment-preparation, include=FALSE}
# Clean memory 
rm(list=ls())
gc()

# Load package
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, data.table, here, sf, tmap, units, knitr, kableExtra)

# List directories 
dir <- list()
dir$root <- here()
dir$data <- here(dir$root, "data")
dir$raw <- here(dir$data, "raw")
dir$derived <- here(dir$data, "derived")
dir$final <- here(dir$data, "final")
dir$script <- here(dir$root, "script")
dir$output <- here(dir$root, "output")

# Create non existing directories
lapply(dir, function(i) dir.create(i, recursive = T, showWarnings = F))

```

```{r color-palette, include=FALSE}
c25 <- c(
  "dodgerblue2", "#E31A1C", # red
  "green4",
  "#6A3D9A", # purple
  "#FF7F00", # orange
  "black", "gold1",
  "skyblue2", "#FB9A99", # lt pink
  "palegreen2",
  "#CAB2D6", # lt purple
  "#FDBF6F", # lt orange
  "gray70", "khaki2",
  "maroon", "orchid1", "deeppink1", "blue1", "steelblue4",
  "darkturquoise", "green1", "yellow4", "yellow3",
  "darkorange4", "brown"
)

```

## Introduction

Ce document présente la répartition des cultures en Bretagne à partir des données du **Registre Parcellaire Graphique** (RPG). Le RPG est une base de données géographique qui recense les parcelles agricoles et les cultures qui y sont pratiquées. Ces données sont déclarées par les agriculteurs dans le cadre de leur déclaration de la Politique Agricole Commune. Elles sont en [libre accès](https://geoservices.ign.fr/rpg) et sont mises à jour chaque année. 

L'objectif de cette analyse est de visualiser la diversité des cultures pratiquées en Bretagne et d'identifier les principales cultures présentes dans la région. En particulier, nous souhaitons identifier les dynamiques des cultures (cultures émergentes ou en déclin) ainsi que leur répartition spatiale. Cette analyse utilise les données du RPG sur 17 années (2007-2023), aggrégées à l'échelle de la commune. Les scripts permettant de collecter, et préparer les données du RPG sont disponibles sur GitHub dans le dépôts [`RPG_PrepareData`](https://github.com/loichy/RPG_PrepareData) Nous disposons ainsi de l'usage des sols entre 24 et 28 grands groupes de culture. Nous mesurons la surface dédié à chaque groupe de culture par commune et année, ainsi que le nombre de parcelles.

Dans une première partie, nous présentons l'usage des sols de manière globale en Bretagne sur la période 2007-2023. Dans la deuxième section, nous étudions la dynamique des usages des sols, en étudiant en particulier l'expansion des cultures émergentes et le déclin des cultures en perte de vitesse. Enfin, nous étudions la diversité des cultures à l'échelle des communes et son évolution dans le temps.

## Le mix cultural en Bretagne: une présentation générale

### Evolution de la surface agricole en Bretagne

Le graphique ci-dessous montre l'évolution sur la période 2007-2023 de la surface agricole totale en Bretagne ainsi que sa distribution entre communes.

### La spécialisation des cultures en Bretagne

#### Surface agricole par culture

La tableau ci-dessous présente les surfaces agricoles utilisés par culture en Bretagne sur la période 2007-2023. Il s'agit du total des surfaces par culture sur toutes les parcelles, qui est calculé par année et dont nous présentons ici la moyenne sur la période 2007-2023.

```{r load-data, include=FALSE}
# Load data
RPG_R53 <- readRDS(here(dir$raw, "RPG_Aggregated_Brittany.rds"))
RPG_R53_wide <- readRDS(here(dir$raw, "RPG_Aggregated_Brittany_wide.rds"))

```


```{r desc-stat, include=FALSE}
# Descriptive statistics
RPG_R53_total <- RPG_R53_wide %>% 
  group_by(insee) %>% 
  summarise(
    mean_surf_agri = mean(surf_agri_geo_unit_m2, na.rm = TRUE)
  ) %>% 
  ungroup() %>% 
  summarise(
    total_surf_agri = sum(mean_surf_agri, na.rm = TRUE)
  )

RPG_R53_desc <- RPG_R53 %>% 
  group_by(LIBELLE_GROUPE_CULTURE, insee) %>% 
  summarise(
    mean_surf_ha = mean(surf_code_group_m2, na.rm = TRUE),
    mean_surf_perc = mean(surf_code_group_perc, na.rm = TRUE)
  ) %>% 
  ungroup() %>% 
  group_by(LIBELLE_GROUPE_CULTURE) %>%
  summarise(
    surf_ha = sum(mean_surf_ha, na.rm = TRUE),
    surf_perc = sum(mean_surf_ha, na.rm = TRUE) / RPG_R53_total$total_surf_agri
  ) %>% 
  arrange(desc(surf_ha)) %>% 
  filter(! is.na(LIBELLE_GROUPE_CULTURE))
  

# Calcul de la surface agricole totale (en ha)
total_surf_agri <- sum(RPG_R53_desc$surf_ha)

# Créer une ligne de résumé
ligne_total <- tibble::tibble(
  LIBELLE_GROUPE_CULTURE = "Surface agricole totale",
  surf_ha = total_surf_agri,
  surf_perc  = NA
)

# Ajouter à la fin du tableau
df_total <- bind_rows(RPG_R53_desc, ligne_total) %>% 
  arrange(desc(surf_ha)) 

```

```{r desc-stat-table, echo=FALSE, results='asis'}
RPG_R53_desc_clean <- df_total %>%
  mutate(
    surf_ha = as.numeric(surf_ha) / 10000,
    surf_perc = as.numeric(surf_perc) * 100
  ) %>%
  select(LIBELLE_GROUPE_CULTURE, surf_ha, surf_perc) %>%
  rename(
    "Groupe de culture" = LIBELLE_GROUPE_CULTURE,
    "Surface de la culture (ha)" = surf_ha,
    "Part (%)" = surf_perc
  )

knitr::kable(RPG_R53_desc_clean, 
             digits = 1, 
             format = "markdown", 
             align = "lrrr",
             caption = "Utilisation des sols agricoles par culture (moyenne sur la période 2007–2023)")

```
*Note : Les surfaces sont exprimées en hectares (ha) ; les parts correspondent à la proportion de chaque culture par rapport à la surface agricole totale.*

La surface agricole totale est de `r round(as.numeric(total_surf_agri) / 10000, 1)` ha. Notons que le [recensement agricole de 2020](https://draaf.bretagne.agriculture.gouv.fr/agreste-etudes-no4-2021-recensement-agricole-2020-la-bretagne-perd-un-quart-de-a2611.html) reporte une surface agricole totale de 1 624 200 ha, soit une surface `r round(((round(as.numeric(total_surf_agri) / 10000, 1) / 1624200) - 1) * 100,2) ` % plus petite. 

La culture la plus répandue en Bretagne est **le maïs**, qui représente `r round(RPG_R53_desc$surf_perc[1] * 100, 1)` % de la surface agricole totale. Le maïs est suivi par les **prairies permanentes et temporaires**, qui représentent respectivement `r round(RPG_R53_desc$surf_perc[2] * 100, 1)` % et `r round(RPG_R53_desc$surf_perc[4] * 100, 1)` % de la surface agricole totale. **Le blé tendre, l'orge et les autres céréales** complètent le tableau des principales cultures, représentant respectivement `r round(RPG_R53_desc$surf_perc[3] * 100, 1)` %, `r round(RPG_R53_desc$surf_perc[5] * 100, 1)` % et `r round(RPG_R53_desc$surf_perc[6] * 100, 1)` % de la surface agricole totale.

#### Part de parcelles agricoles par culture

La figure ci-dessous représente le pourcentage de parcelles agricoles par type de culture en Bretagne pour quatre années (2007, 2012, 2017 et 2023). Il s'agit du nombre de parcelles par culture divisé par le nombre total de parcelles recensés par le RPG en Bretagne sur l'année.

```{r nb-parcels, include=FALSE}

year_simplified <- c(2007, 2012, 2017, 2023)

RPG_R53_simplified <- RPG_R53 %>%
  filter(year %in% year_simplified)

# Nombre total de parcelles par année
N_Parcels_byyear <- RPG_R53_simplified %>% 
  group_by(year) %>%
  summarise(N_Parcels_byyear = sum(parcel_cult_code_group_n))

# Agréger par année et culture
df_parcelles <- RPG_R53_simplified %>%
  ungroup() %>% 
  left_join(N_Parcels_byyear, by = "year") %>%
  group_by(year, LIBELLE_GROUPE_CULTURE) %>%
  summarise(Share_parcels = sum(parcel_cult_code_group_n, na.rm = TRUE) / N_Parcels_byyear * 100 ) %>% 
  group_by(LIBELLE_GROUPE_CULTURE, year) %>%
  slice(1) %>% 
  ungroup() %>% 
  arrange(year, desc(Share_parcels)) %>% 
  filter(! is.na(LIBELLE_GROUPE_CULTURE)) %>% 
  mutate(LIBELLE_GROUPE_CULTURE = fct_reorder(LIBELLE_GROUPE_CULTURE, Share_parcels, .fun = sum, .desc = TRUE))
  # Take the first row of each group
  


```

```{r nb-parcels-plot, echo=FALSE, fig.width=10, fig.height=6}
ggplot(df_parcelles, aes(x = LIBELLE_GROUPE_CULTURE, y = Share_parcels)) +
  geom_col(fill = "darkgrey") +
  facet_wrap(~ year, ncol = 2) +
  labs(
    title = "Pöurcentage de parcelles par type de culture",
    x = "Type de culture",
    y = "Nombre de parcelles"
  ) +
  coord_flip() +
  theme_minimal()

ggsave(here(dir$output, "Pourcentage_parcelles_culture.pdf"), width = 10, height = 6)

```

Nous remarquons que les cultures occupant la très grande majorité des parcelles sur la période sont aussi celles qui dominent la surface agricole totale. En effet, les **prairies permanentes et temporaires** ainsi que le **maïs** représentent à eux seuls plus de 50 % des parcelles agricoles en Bretagne. Le **blé tendre**, l'**orge** et les **autres céréales** sont également des cultures très répandues, représentant respectivement environ 10 % des parcelles agricoles. Le blé, l'orge et les autres céréales complètent également ce tableau.

Cependant, des cultures moins visibles dans la surface agricole totale paraissent comme plus présentent en pourcentage de parcelles. Il s'agit de culture cultivée souvent sur des plus petites parcelles, telles que les légumes ou fleurs, et les cultures divers. Si celles-ci représentent respectivement 3.2% et 1% de la surface agricole totale, elles représentent 3.9% et 8.9% des parcelles cultivées en Bretagne en 2017.


## Evolution dynamique du mix cultural en Bretagne

Cette section préésente des analyses statistiques visant à identifier des cultures en développement et en déclin en Bretagne. Etant donné le grand nombre de catégorie de cultures différentes, et la très grande domination de la surface agricole pour certaines de ces cultures la comparaison directe de l'évolution des surfaces n'ait pas rendue facile. Certaines cultures ont des surfaces très largement supérieur, par exemple la culture de maïs est environ 1 000 fois plus importante en surface que la culture des légumineuses. 

Pour cette raison, nous avons choisi de présenter les évolutions relatives des surfaces agricoles par culture. Dans un premier temps, nous calculons alors le taux de croissance inter-annuel des surfaces agricoles utilisés par la culture, de la manière suivante $g_{kt} = \dfrac{y_{kt} - y_{kt-1}}{y_{kt-1}}$, où $g_{kt}$ est le taux de croissance de la culture $k$ à l'année $t$, et $y_{kt}$ est la surface agricole utilisée par la culture $k$ à l'année $t$. Cette analyse permet de comprendre la variabilité entre année des surfaces utilisés par la culture.

Dans un second temps, nous calculons la croissance de la surface associé à la culture en base 100, où l'année de référence est celle associée à l'entrée de la culture dans les données RPG. Ainsi, pour chaque culture, nous calculons la surface agricole utilisée par la culture $k$ à l'année $t$ divisé par la surface agricole utilisée par la culture $k$ à l'année d'entrée dans les données RPG, que nous multiplions par 100. Cette analyse permet de comprendre l'évolution des surfaces agricoles utilisées par la culture depuis son entrée dans les données RPG, et de comparer alors les croissances des surfaces entre culture.