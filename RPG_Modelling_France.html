<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>RPG_Modelling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="RPG_Modelling_France_files/libs/clipboard/clipboard.min.js"></script>
<script src="RPG_Modelling_France_files/libs/quarto-html/quarto.js"></script>
<script src="RPG_Modelling_France_files/libs/quarto-html/popper.min.js"></script>
<script src="RPG_Modelling_France_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="RPG_Modelling_France_files/libs/quarto-html/anchor.min.js"></script>
<link href="RPG_Modelling_France_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="RPG_Modelling_France_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="RPG_Modelling_France_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="RPG_Modelling_France_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="RPG_Modelling_France_files/libs/bootstrap/bootstrap-1bc8a17f135ab3d594c857e9f48e611b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">RPG_Modelling</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare environment</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean memory </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          used (Mb) gc trigger (Mb) max used (Mb)
Ncells  596951 31.9    1360544 72.7   768919 41.1
Vcells 1093324  8.4    8388608 64.0  1876200 14.4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load package</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Le chargement a nécessité le package : pacman</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'pacman' a été compilé avec la version R 4.4.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, data.table, here, sf, tmap, units, dplyr, modelsummary, fixest)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># List directories </span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>dir<span class="sc">$</span>root <span class="ot">&lt;-</span> <span class="fu">here</span>()</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>dir<span class="sc">$</span>data <span class="ot">&lt;-</span> <span class="fu">here</span>(dir<span class="sc">$</span>root, <span class="st">"data"</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>dir<span class="sc">$</span>raw <span class="ot">&lt;-</span> <span class="fu">here</span>(dir<span class="sc">$</span>data, <span class="st">"raw"</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>dir<span class="sc">$</span>derived <span class="ot">&lt;-</span> <span class="fu">here</span>(dir<span class="sc">$</span>data, <span class="st">"derived"</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>dir<span class="sc">$</span>final <span class="ot">&lt;-</span> <span class="fu">here</span>(dir<span class="sc">$</span>data, <span class="st">"final"</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>dir<span class="sc">$</span>script <span class="ot">&lt;-</span> <span class="fu">here</span>(dir<span class="sc">$</span>root, <span class="st">"script"</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>dir<span class="sc">$</span>output <span class="ot">&lt;-</span> <span class="fu">here</span>(dir<span class="sc">$</span>root, <span class="st">"output"</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create non existing directories</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(dir, <span class="cf">function</span>(i) <span class="fu">dir.create</span>(i, <span class="at">recursive =</span> T, <span class="at">showWarnings =</span> F))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$root
[1] FALSE

$data
[1] FALSE

$raw
[1] FALSE

$derived
[1] FALSE

$final
[1] FALSE

$script
[1] FALSE

$output
[1] FALSE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare datasets</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>cultures_select <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Blé tendre"</span>, <span class="st">"Maïs grain et ensilage"</span>, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Protéagineux"</span>, <span class="st">"Légumineuses à grains"</span>, <span class="st">"Plantes à fibres"</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>trad_cultures <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">crop =</span> <span class="fu">c</span>(<span class="st">"Dry pea"</span>, <span class="st">"Flax"</span>, <span class="st">"Maize"</span>, <span class="st">"Wheat"</span>),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">culture_fr =</span> <span class="fu">c</span>(<span class="st">"Légumineuses à grains"</span>, <span class="st">"Plantes à fibres"</span>, <span class="st">"Maïs grain et ensilage"</span>, <span class="st">"Blé tendre"</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>RPG_Variations <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(dir<span class="sc">$</span>raw, <span class="st">"LongPeriod_AcreageVariations.rds"</span>))</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>GAEZ_yield <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(dir<span class="sc">$</span>raw, <span class="st">"GAEZ_yieldchange_communes_filt.rds"</span>))</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>RPG_Variations_filt <span class="ot">&lt;-</span> RPG_Variations <span class="sc">|&gt;</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(LIBELLE_GROUPE_CULTURE <span class="sc">%in%</span> cultures_select) <span class="sc">|&gt;</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">crop =</span> LIBELLE_GROUPE_CULTURE)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>GAEZ_yield_filt <span class="ot">&lt;-</span> GAEZ_yield <span class="sc">|&gt;</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variable <span class="sc">==</span> <span class="st">"ylHr"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(crop <span class="sc">!=</span> <span class="st">"Gram"</span> <span class="sc">&amp;</span> crop <span class="sc">!=</span> <span class="st">"Chickpea"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">crop =</span> <span class="fu">recode</span>(crop, </span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"Dry pea"</span> <span class="ot">=</span> <span class="st">"Légumineuses à grains"</span>,</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"Flax"</span> <span class="ot">=</span> <span class="st">"Plantes à fibres"</span>,</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"Maize"</span> <span class="ot">=</span> <span class="st">"Maïs grain et ensilage"</span>, </span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"Wheat"</span> <span class="ot">=</span> <span class="st">"Blé tendre"</span>))</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>df_final <span class="ot">&lt;-</span> GAEZ_yield_filt <span class="sc">|&gt;</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(RPG_Variations_filt, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"insee"</span>, <span class="st">"crop"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add back to the dataset the region_code column</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>df_final <span class="ot">&lt;-</span> df_final <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dept_code =</span> <span class="fu">str_sub</span>(<span class="fu">as.character</span>(insee), <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">dept_code =</span> <span class="fu">ifelse</span>(dept_code <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"2A"</span>, <span class="st">"2B"</span>), <span class="st">"20"</span>, dept_code))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>dept_to_region <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"01"</span><span class="ot">=</span><span class="st">"84"</span>, <span class="st">"02"</span><span class="ot">=</span><span class="st">"32"</span>, <span class="st">"03"</span><span class="ot">=</span><span class="st">"84"</span>, <span class="st">"04"</span><span class="ot">=</span><span class="st">"93"</span>, <span class="st">"05"</span><span class="ot">=</span><span class="st">"93"</span>, <span class="st">"06"</span><span class="ot">=</span><span class="st">"93"</span>, <span class="st">"07"</span><span class="ot">=</span><span class="st">"84"</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"08"</span><span class="ot">=</span><span class="st">"44"</span>, <span class="st">"09"</span><span class="ot">=</span><span class="st">"76"</span>, <span class="st">"10"</span><span class="ot">=</span><span class="st">"44"</span>, <span class="st">"11"</span><span class="ot">=</span><span class="st">"76"</span>, <span class="st">"12"</span><span class="ot">=</span><span class="st">"76"</span>, <span class="st">"13"</span><span class="ot">=</span><span class="st">"93"</span>, <span class="st">"14"</span><span class="ot">=</span><span class="st">"28"</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"15"</span><span class="ot">=</span><span class="st">"84"</span>, <span class="st">"16"</span><span class="ot">=</span><span class="st">"75"</span>, <span class="st">"17"</span><span class="ot">=</span><span class="st">"75"</span>, <span class="st">"18"</span><span class="ot">=</span><span class="st">"24"</span>, <span class="st">"19"</span><span class="ot">=</span><span class="st">"75"</span>, <span class="st">"20"</span><span class="ot">=</span><span class="st">"94"</span>, <span class="st">"21"</span><span class="ot">=</span><span class="st">"27"</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"22"</span><span class="ot">=</span><span class="st">"53"</span>, <span class="st">"23"</span><span class="ot">=</span><span class="st">"75"</span>, <span class="st">"24"</span><span class="ot">=</span><span class="st">"75"</span>, <span class="st">"25"</span><span class="ot">=</span><span class="st">"27"</span>, <span class="st">"26"</span><span class="ot">=</span><span class="st">"84"</span>, <span class="st">"27"</span><span class="ot">=</span><span class="st">"28"</span>, <span class="st">"28"</span><span class="ot">=</span><span class="st">"24"</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"29"</span><span class="ot">=</span><span class="st">"53"</span>, <span class="st">"30"</span><span class="ot">=</span><span class="st">"76"</span>, <span class="st">"31"</span><span class="ot">=</span><span class="st">"76"</span>, <span class="st">"32"</span><span class="ot">=</span><span class="st">"76"</span>, <span class="st">"33"</span><span class="ot">=</span><span class="st">"75"</span>, <span class="st">"34"</span><span class="ot">=</span><span class="st">"76"</span>, <span class="st">"35"</span><span class="ot">=</span><span class="st">"53"</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"36"</span><span class="ot">=</span><span class="st">"24"</span>, <span class="st">"37"</span><span class="ot">=</span><span class="st">"24"</span>, <span class="st">"38"</span><span class="ot">=</span><span class="st">"84"</span>, <span class="st">"39"</span><span class="ot">=</span><span class="st">"27"</span>, <span class="st">"40"</span><span class="ot">=</span><span class="st">"75"</span>, <span class="st">"41"</span><span class="ot">=</span><span class="st">"24"</span>, <span class="st">"42"</span><span class="ot">=</span><span class="st">"84"</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"43"</span><span class="ot">=</span><span class="st">"84"</span>, <span class="st">"44"</span><span class="ot">=</span><span class="st">"52"</span>, <span class="st">"45"</span><span class="ot">=</span><span class="st">"24"</span>, <span class="st">"46"</span><span class="ot">=</span><span class="st">"76"</span>, <span class="st">"47"</span><span class="ot">=</span><span class="st">"75"</span>, <span class="st">"48"</span><span class="ot">=</span><span class="st">"76"</span>, <span class="st">"49"</span><span class="ot">=</span><span class="st">"52"</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"50"</span><span class="ot">=</span><span class="st">"28"</span>, <span class="st">"51"</span><span class="ot">=</span><span class="st">"44"</span>, <span class="st">"52"</span><span class="ot">=</span><span class="st">"44"</span>, <span class="st">"53"</span><span class="ot">=</span><span class="st">"52"</span>, <span class="st">"54"</span><span class="ot">=</span><span class="st">"44"</span>, <span class="st">"55"</span><span class="ot">=</span><span class="st">"44"</span>, <span class="st">"56"</span><span class="ot">=</span><span class="st">"53"</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"57"</span><span class="ot">=</span><span class="st">"44"</span>, <span class="st">"58"</span><span class="ot">=</span><span class="st">"27"</span>, <span class="st">"59"</span><span class="ot">=</span><span class="st">"32"</span>, <span class="st">"60"</span><span class="ot">=</span><span class="st">"32"</span>, <span class="st">"61"</span><span class="ot">=</span><span class="st">"28"</span>, <span class="st">"62"</span><span class="ot">=</span><span class="st">"32"</span>, <span class="st">"63"</span><span class="ot">=</span><span class="st">"84"</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"64"</span><span class="ot">=</span><span class="st">"75"</span>, <span class="st">"65"</span><span class="ot">=</span><span class="st">"76"</span>, <span class="st">"66"</span><span class="ot">=</span><span class="st">"76"</span>, <span class="st">"67"</span><span class="ot">=</span><span class="st">"44"</span>, <span class="st">"68"</span><span class="ot">=</span><span class="st">"44"</span>, <span class="st">"69"</span><span class="ot">=</span><span class="st">"84"</span>, <span class="st">"70"</span><span class="ot">=</span><span class="st">"27"</span>,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"71"</span><span class="ot">=</span><span class="st">"27"</span>, <span class="st">"72"</span><span class="ot">=</span><span class="st">"52"</span>, <span class="st">"73"</span><span class="ot">=</span><span class="st">"84"</span>, <span class="st">"74"</span><span class="ot">=</span><span class="st">"84"</span>, <span class="st">"75"</span><span class="ot">=</span><span class="st">"11"</span>, <span class="st">"76"</span><span class="ot">=</span><span class="st">"28"</span>, <span class="st">"77"</span><span class="ot">=</span><span class="st">"11"</span>,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"78"</span><span class="ot">=</span><span class="st">"11"</span>, <span class="st">"79"</span><span class="ot">=</span><span class="st">"75"</span>, <span class="st">"80"</span><span class="ot">=</span><span class="st">"32"</span>, <span class="st">"81"</span><span class="ot">=</span><span class="st">"76"</span>, <span class="st">"82"</span><span class="ot">=</span><span class="st">"76"</span>, <span class="st">"83"</span><span class="ot">=</span><span class="st">"93"</span>, <span class="st">"84"</span><span class="ot">=</span><span class="st">"93"</span>,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"85"</span><span class="ot">=</span><span class="st">"52"</span>, <span class="st">"86"</span><span class="ot">=</span><span class="st">"75"</span>, <span class="st">"87"</span><span class="ot">=</span><span class="st">"75"</span>, <span class="st">"88"</span><span class="ot">=</span><span class="st">"44"</span>, <span class="st">"89"</span><span class="ot">=</span><span class="st">"27"</span>, <span class="st">"90"</span><span class="ot">=</span><span class="st">"27"</span>, <span class="st">"91"</span><span class="ot">=</span><span class="st">"11"</span>,</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"92"</span><span class="ot">=</span><span class="st">"11"</span>, <span class="st">"93"</span><span class="ot">=</span><span class="st">"11"</span>, <span class="st">"94"</span><span class="ot">=</span><span class="st">"11"</span>, <span class="st">"95"</span><span class="ot">=</span><span class="st">"11"</span>, <span class="st">"971"</span><span class="ot">=</span><span class="st">"01"</span>, <span class="st">"972"</span><span class="ot">=</span><span class="st">"02"</span>, <span class="st">"973"</span><span class="ot">=</span><span class="st">"03"</span>,</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"974"</span><span class="ot">=</span><span class="st">"04"</span>, <span class="st">"976"</span><span class="ot">=</span><span class="st">"06"</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>df_final <span class="ot">&lt;-</span> df_final <span class="sc">|&gt;</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region_code =</span> dept_to_region[dept_code])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="elasticity-of-area-to-potential-yield" class="level2">
<h2 class="anchored" data-anchor-id="elasticity-of-area-to-potential-yield">Elasticity of area to potential yield</h2>
<p>In general, we use percentage change as our dependent variable, as it is more straightforward to interpret and also controls for scale differences at the communal level.</p>
<section id="dependent-variable-acreage-variations-between-2023-and-2007" class="level3">
<h3 class="anchored" data-anchor-id="dependent-variable-acreage-variations-between-2023-and-2007">Dependent variable : acreage variations between 2023 and 2007</h3>
<section id="ordinary-least-squares-model" class="level4">
<h4 class="anchored" data-anchor-id="ordinary-least-squares-model">Ordinary Least Squares Model</h4>
<p>First, we use the percentage change in acreage per crop between 2023 and 2007 as our dependent variable. Our main independent variables are <code>value</code>, corresponding to potential yield level under the <strong>rcp8p5</strong> climate change scenario of the <strong>HadGEM2-ES</strong> model, as well as <code>value_hist</code>, the historical yield level. To avoid potential multicollinearity problems, we use the log-difference between the two variables which capture the same information with more stable coefficients.</p>
<p>We are interested in comparing coefficients between our crops of interest, therefore we run regressions separately for the four of them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating separate datasets for each culture we want to analyze</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Wheat</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>df_final_w <span class="ot">&lt;-</span> df_final <span class="sc">|&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(crop <span class="sc">==</span> <span class="st">"Blé tendre"</span>) </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Maize</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>df_final_m <span class="ot">&lt;-</span> df_final <span class="sc">|&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(crop <span class="sc">==</span> <span class="st">"Maïs grain et ensilage"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Pea</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>df_final_p <span class="ot">&lt;-</span> df_final <span class="sc">|&gt;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(crop <span class="sc">==</span> <span class="st">"Légumineuses à grains"</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Flax</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>df_final_f <span class="ot">&lt;-</span> df_final <span class="sc">|&gt;</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(crop <span class="sc">==</span> <span class="st">"Plantes à fibres"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We construct an OLS specification with regional fixed effects using the <code>feols()</code> command that we then compare with a benchmark specification without fixed effects. The following tables show for each specifications the regression results by crop.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard OLS regression without fixed effects using feols command to deal with Inf/NaN observations</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>reg0_wheat <span class="ot">&lt;-</span> <span class="fu">feols</span>(diff_2007_2023_perc <span class="sc">~</span> <span class="fu">log</span>(value) <span class="sc">-</span> <span class="fu">log</span>(value_hist), <span class="at">data =</span> df_final_w)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 6,349 observations removed because of NA and infinite values (LHS: 6,329, RHS: 93).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>reg0_maize <span class="ot">&lt;-</span> <span class="fu">feols</span>(diff_2007_2023_perc <span class="sc">~</span> <span class="fu">log</span>(value) <span class="sc">-</span> <span class="fu">log</span>(value_hist), <span class="at">data =</span> df_final_m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 8,807 observations removed because of NA and infinite values (LHS: 8,796, RHS: 104).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>reg0_pea <span class="ot">&lt;-</span> <span class="fu">feols</span>(diff_2007_2023_perc <span class="sc">~</span> <span class="fu">log</span>(value) <span class="sc">-</span> <span class="fu">log</span>(value_hist), <span class="at">data =</span> df_final_p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 34,214 observations removed because of NA and infinite values (LHS: 34,214, RHS: 94).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>reg0_flax <span class="ot">&lt;-</span> <span class="fu">feols</span>(diff_2007_2023_perc <span class="sc">~</span> <span class="fu">log</span>(value) <span class="sc">-</span> <span class="fu">log</span>(value_hist), <span class="at">data =</span> df_final_f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 32,131 observations removed because of NA and infinite values (LHS: 32,130, RHS: 93).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>reg0_results <span class="ot">&lt;-</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modelsummary</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"Wheat"</span> <span class="ot">=</span> reg0_wheat, </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Maize"</span> <span class="ot">=</span> reg0_maize, </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Pea"</span> <span class="ot">=</span> reg0_pea, </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Flax"</span> <span class="ot">=</span> reg0_flax), </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">stars =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="st">"std.error"</span>,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_map =</span> <span class="fu">c</span>(<span class="st">"log(value)"</span> <span class="ot">=</span>  <span class="st">"Potential Yield"</span>, </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>               <span class="st">"log(value_hist)"</span> <span class="ot">=</span> <span class="st">"Historical Yield"</span>),</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"markdown"</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(reg0_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
+-----------------+------------+-----------+----------+----------+
|                 | Wheat      | Maize     | Pea      | Flax     |
+=================+============+===========+==========+==========+
| Potential Yield | -66.256*** | -45.981** | 49.551   | -52.443  |
+-----------------+------------+-----------+----------+----------+
|                 | (12.219)   | (15.218)  | (50.702) | (50.887) |
+-----------------+------------+-----------+----------+----------+
| Num.Obs.        | 28477      | 26019     | 612      | 2695     |
+-----------------+------------+-----------+----------+----------+
| R2              | 0.001      | 0.000     | 0.002    | 0.000    |
+-----------------+------------+-----------+----------+----------+
| R2 Adj.         | 0.001      | 0.000     | 0.000    | 0.000    |
+-----------------+------------+-----------+----------+----------+
| AIC             | 453553.8   | 435743.6  | 9846.4   | 43346.7  |
+-----------------+------------+-----------+----------+----------+
| BIC             | 453570.3   | 435760.0  | 9855.2   | 43358.5  |
+-----------------+------------+-----------+----------+----------+
| RMSE            | 695.41     | 1047.91   | 751.63   | 751.74   |
+-----------------+------------+-----------+----------+----------+
| Std.Errors      | IID        | IID       | IID      | IID      |
+=================+============+===========+==========+==========+
| + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001              |
+=================+============+===========+==========+==========+ </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OLS results with regional fixed effects</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>reg1_wheat <span class="ot">&lt;-</span> <span class="fu">feols</span>(diff_2007_2023_perc <span class="sc">~</span> <span class="fu">log</span>(value) <span class="sc">-</span> <span class="fu">log</span>(value_hist) <span class="sc">|</span> region_code, <span class="at">data =</span> df_final_w)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 6,349 observations removed because of NA and infinite values (LHS: 6,329, RHS: 93).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>reg1_maize <span class="ot">&lt;-</span> <span class="fu">feols</span>(diff_2007_2023_perc <span class="sc">~</span> <span class="fu">log</span>(value) <span class="sc">-</span> <span class="fu">log</span>(value_hist) <span class="sc">|</span> region_code, <span class="at">data =</span> df_final_m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 8,807 observations removed because of NA and infinite values (LHS: 8,796, RHS: 104).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>reg1_pea <span class="ot">&lt;-</span> <span class="fu">feols</span>(diff_2007_2023_perc <span class="sc">~</span> <span class="fu">log</span>(value) <span class="sc">-</span> <span class="fu">log</span>(value_hist) <span class="sc">|</span> region_code, <span class="at">data =</span> df_final_p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 34,214 observations removed because of NA and infinite values (LHS: 34,214, RHS: 94).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>reg1_flax <span class="ot">&lt;-</span> <span class="fu">feols</span>(diff_2007_2023_perc <span class="sc">~</span> <span class="fu">log</span>(value) <span class="sc">-</span> <span class="fu">log</span>(value_hist) <span class="sc">|</span> region_code, <span class="at">data =</span> df_final_f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 32,131 observations removed because of NA and infinite values (LHS: 32,130, RHS: 93).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>reg1_results <span class="ot">&lt;-</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modelsummary</span>(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"Wheat"</span> <span class="ot">=</span> reg1_wheat, </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Maize"</span> <span class="ot">=</span> reg1_maize, </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Pea"</span> <span class="ot">=</span> reg1_pea, </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Flax"</span> <span class="ot">=</span> reg1_flax), </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">stars =</span> <span class="cn">TRUE</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="st">"std.error"</span>,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_map =</span> <span class="fu">c</span>(<span class="st">"log(value)"</span> <span class="ot">=</span>  <span class="st">"Potential Yield"</span>, </span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>               <span class="st">"log(value_hist)"</span> <span class="ot">=</span> <span class="st">"Historical Yield"</span>),</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"markdown"</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We find that in both specifications, there is a negative relationship between potential yield change and acreage change for <strong>wheat, maize and flax</strong>. On the contrary, an increase in potential yield compared to the historical value of <strong>pea</strong> induces an increase in its acreage.</p>
<p>Furthermore, the model with fixed effects shows only significance for the coefficient on this latter crop, when in the benchmark model, the coefficients on <strong>wheat and maize</strong> are significant. We observe that adding regional fixed effects reduced considerably the magnitude and the significance of the coefficient on <strong>wheat</strong>. In general, the R2 improved by adding regional fixed effects.</p>
<p>However these results are not satisfactory as they point to contradictory results with theory. Indeed, increased potential yield should urge producers to cultivate those crops on larger surfaces. We will now try to improve our results by using potential yield change in percentage as computed by the <strong>GAEZ database</strong>, still controlling for historical yield values, and including an interaction term as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OLS results with potential yield change as main explanatory variable</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>reg2_wheat <span class="ot">&lt;-</span> <span class="fu">feols</span>(diff_2007_2023_perc <span class="sc">~</span> change<span class="sc">*</span>value_hist, <span class="at">data =</span> df_final_w)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 6,363 observations removed because of NA and infinite values (LHS: 6,329, RHS: 214).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>reg2_maize <span class="ot">&lt;-</span> <span class="fu">feols</span>(diff_2007_2023_perc <span class="sc">~</span> change<span class="sc">*</span>value_hist, <span class="at">data =</span> df_final_m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 9,599 observations removed because of NA and infinite values (LHS: 8,796, RHS: 2,434).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>reg2_pea <span class="ot">&lt;-</span> <span class="fu">feols</span>(diff_2007_2023_perc <span class="sc">~</span> change<span class="sc">*</span>value_hist, <span class="at">data =</span> df_final_p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 34,215 observations removed because of NA and infinite values (LHS: 34,214, RHS: 284).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>reg2_flax <span class="ot">&lt;-</span> <span class="fu">feols</span>(diff_2007_2023_perc <span class="sc">~</span> change<span class="sc">*</span>value_hist, <span class="at">data =</span> df_final_f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 32,131 observations removed because of NA and infinite values (LHS: 32,130, RHS: 235).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>reg2_results <span class="ot">&lt;-</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modelsummary</span>(</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"Wheat"</span> <span class="ot">=</span> reg2_wheat, </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Maize"</span> <span class="ot">=</span> reg2_maize, </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Pea"</span> <span class="ot">=</span> reg2_pea, </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Flax"</span> <span class="ot">=</span> reg2_flax), </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">stars =</span> <span class="cn">TRUE</span>,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="st">"std.error"</span>,</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_map =</span> <span class="fu">c</span>(<span class="st">"change"</span> <span class="ot">=</span> <span class="st">"Potential Yield Change"</span>, </span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>               <span class="st">"value_hist"</span> <span class="ot">=</span> <span class="st">"Historical Yield"</span>,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"change:value_hist"</span> <span class="ot">=</span> <span class="st">"Interaction"</span>),</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"markdown"</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(reg2_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
+------------------------+-----------+----------+-----------+-----------+
|                        | Wheat     | Maize    | Pea       | Flax      |
+========================+===========+==========+===========+===========+
| Potential Yield Change | 40.564    | 1.113    | -38.636   | -837.373* |
+------------------------+-----------+----------+-----------+-----------+
|                        | (45.936)  | (19.594) | (398.832) | (422.337) |
+------------------------+-----------+----------+-----------+-----------+
| Historical Yield       | -0.016*** | -0.015** | -0.024    | -0.435*** |
+------------------------+-----------+----------+-----------+-----------+
|                        | (0.003)   | (0.005)  | (0.066)   | (0.090)   |
+------------------------+-----------+----------+-----------+-----------+
| Interaction            | -0.021*   | -0.028** | 0.205     | 2.197***  |
+------------------------+-----------+----------+-----------+-----------+
|                        | (0.009)   | (0.011)  | (0.260)   | (0.490)   |
+------------------------+-----------+----------+-----------+-----------+
| Num.Obs.               | 28463     | 25227    | 611       | 2695      |
+------------------------+-----------+----------+-----------+-----------+
| R2                     | 0.001     | 0.000    | 0.004     | 0.013     |
+------------------------+-----------+----------+-----------+-----------+
| R2 Adj.                | 0.001     | 0.000    | -0.001    | 0.012     |
+------------------------+-----------+----------+-----------+-----------+
| AIC                    | 453337.4  | 421457.3 | 9833.5    | 43317.0   |
+------------------------+-----------+----------+-----------+-----------+
| BIC                    | 453370.4  | 421489.8 | 9851.2    | 43340.6   |
+------------------------+-----------+----------+-----------+-----------+
| RMSE                   | 695.44    | 1026.80  | 751.13    | 747.05    |
+------------------------+-----------+----------+-----------+-----------+
| Std.Errors             | IID       | IID      | IID       | IID       |
+========================+===========+==========+===========+===========+
| + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001                     |
+========================+===========+==========+===========+===========+ </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OLS results with potential yield change as main explanatory variable</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>reg3_wheat <span class="ot">&lt;-</span> <span class="fu">feols</span>(diff_2007_2023_perc <span class="sc">~</span> change<span class="sc">*</span>value_hist <span class="sc">|</span> region_code, <span class="at">data =</span> df_final_w)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 6,363 observations removed because of NA and infinite values (LHS: 6,329, RHS: 214).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>reg3_maize <span class="ot">&lt;-</span> <span class="fu">feols</span>(diff_2007_2023_perc <span class="sc">~</span> change<span class="sc">*</span>value_hist <span class="sc">|</span> region_code, <span class="at">data =</span> df_final_m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 9,599 observations removed because of NA and infinite values (LHS: 8,796, RHS: 2,434).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>reg3_pea <span class="ot">&lt;-</span> <span class="fu">feols</span>(diff_2007_2023_perc <span class="sc">~</span> change<span class="sc">*</span>value_hist <span class="sc">|</span> region_code, <span class="at">data =</span> df_final_p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 34,215 observations removed because of NA and infinite values (LHS: 34,214, RHS: 284).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>reg3_flax <span class="ot">&lt;-</span> <span class="fu">feols</span>(diff_2007_2023_perc <span class="sc">~</span> change<span class="sc">*</span>value_hist <span class="sc">|</span> region_code, <span class="at">data =</span> df_final_f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 32,131 observations removed because of NA and infinite values (LHS: 32,130, RHS: 235).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>reg3_results <span class="ot">&lt;-</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modelsummary</span>(</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"Wheat"</span> <span class="ot">=</span> reg3_wheat, </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Maize"</span> <span class="ot">=</span> reg3_maize, </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Pea"</span> <span class="ot">=</span> reg3_pea, </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Flax"</span> <span class="ot">=</span> reg3_flax), </span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">stars =</span> <span class="cn">TRUE</span>,</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="st">"std.error"</span>,</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_map =</span> <span class="fu">c</span>(<span class="st">"change"</span> <span class="ot">=</span> <span class="st">"Potential Yield Change"</span>, </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>               <span class="st">"value_hist"</span> <span class="ot">=</span> <span class="st">"Historical Yield"</span>,</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"change:value_hist"</span> <span class="ot">=</span> <span class="st">"Interaction"</span>),</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"markdown"</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(reg3_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
+------------------------+-----------------+-----------------+-----------------+-----------------+
|                        | Wheat           | Maize           | Pea             | Flax            |
+========================+=================+=================+=================+=================+
| Potential Yield Change | -27.779         | 2.140           | -21.314         | -398.919        |
+------------------------+-----------------+-----------------+-----------------+-----------------+
|                        | (16.567)        | (9.637)         | (342.550)       | (354.837)       |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| Historical Yield       | -0.004          | -0.016*         | -0.037          | -0.300*         |
+------------------------+-----------------+-----------------+-----------------+-----------------+
|                        | (0.004)         | (0.006)         | (0.026)         | (0.131)         |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| Interaction            | -0.033*         | -0.041*         | 0.396*          | 1.426*          |
+------------------------+-----------------+-----------------+-----------------+-----------------+
|                        | (0.013)         | (0.018)         | (0.145)         | (0.577)         |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| Num.Obs.               | 28463           | 25227           | 611             | 2695            |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| R2                     | 0.013           | 0.005           | 0.019           | 0.024           |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| R2 Adj.                | 0.013           | 0.004           | -0.004          | 0.019           |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| R2 Within              | 0.001           | 0.001           | 0.010           | 0.006           |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| R2 Within Adj.         | 0.001           | 0.001           | 0.005           | 0.004           |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| AIC                    | 453021.7        | 421367.3        | 9846.3          | 43306.9         |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| BIC                    | 453153.8        | 421497.5        | 9912.5          | 43389.5         |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| RMSE                   | 691.30          | 1024.48         | 745.47          | 742.88          |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| Std.Errors             | by: region_code | by: region_code | by: region_code | by: region_code |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| FE: region_code        | X               | X               | X               | X               |
+========================+=================+=================+=================+=================+
| + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001                                              |
+========================+=================+=================+=================+=================+ </code></pre>
</div>
</div>
<p>The results reveal that historical yield is consistently and significantly negatively associated with the percentage change in acreage for <strong>wheat, maize, and flax</strong>. This suggests that crops historically more productive may have seen relatively less acreage expansion. The interaction term between potential yield change and historical yield is also significant for <strong>wheat, maize, and flax</strong>, indicating that the effect of expected yield improvement depends on the initial productivity level. Particularly, the interaction is strongly positive for <strong>flax</strong>, suggesting that potential gains are only realized where historical yields were already high. In contrast, the effect of potential yield change itself is not statistically significant for most crops, except for <strong>flax</strong>, where it shows a large, negative effect (which is weakly significant at the 10% level).</p>
<p>Controlling for regional fixed effects refines the estimation by absorbing unobserved heterogeneity across regions. The historical yield variable remains negatively associated with changes in acreage for maize and flax, both statistically significant. However, for <strong>wheat</strong> and <strong>pea</strong>, historical yield loses statistical significance. The interaction term between historical yield and potential yield change is now statistically significant across all four crops. This suggests that the effect of potential productivity changes on land allocation depends strongly on the initial yield level. The direct effect of potential yield change remains non-significant for all crops, even becoming negative for <strong>wheat and flax</strong>, once fixed effects are included.</p>
</section>
<section id="generalized-additive-model" class="level4">
<h4 class="anchored" data-anchor-id="generalized-additive-model">Generalized Additive Model</h4>
<p>GAM models can be more relevant when using the difference between potential yield under climate change and historical yield as our independent variable. Indeed, the response of land use to climate-induced yield gaps may be nonlinear or threshold-dependent. GAMs can be used to model a smooth function of the said gap.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test du modèle GAM</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Le chargement a nécessité le package : nlme</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attachement du package : 'nlme'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>L'objet suivant est masqué depuis 'package:dplyr':

    collapse</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>This is mgcv 1.9-1. For overview type 'help("mgcv-package")'.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Deleting NaN and Inf</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Wheat</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>df_gam_w <span class="ot">&lt;-</span> df_final_w <span class="sc">|&gt;</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.nan</span>(change) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.infinite</span>(change)) <span class="sc">|&gt;</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.nan</span>(diff_2007_2023_perc) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.infinite</span>(diff_2007_2023_perc))</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Maize</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>df_gam_m <span class="ot">&lt;-</span> df_final_m <span class="sc">|&gt;</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.nan</span>(change) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.infinite</span>(change)) <span class="sc">|&gt;</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.nan</span>(diff_2007_2023_perc) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.infinite</span>(diff_2007_2023_perc)) </span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Pea</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>df_gam_p <span class="ot">&lt;-</span> df_final_p <span class="sc">|&gt;</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.nan</span>(change) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.infinite</span>(change)) <span class="sc">|&gt;</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.nan</span>(diff_2007_2023_perc) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.infinite</span>(diff_2007_2023_perc)) </span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Flax</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>df_gam_f <span class="ot">&lt;-</span> df_final_f <span class="sc">|&gt;</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.nan</span>(change) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.infinite</span>(change)) <span class="sc">|&gt;</span></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.nan</span>(diff_2007_2023_perc) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.infinite</span>(diff_2007_2023_perc))</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>reg1_gam_w <span class="ot">&lt;-</span> <span class="fu">gam</span>(diff_2007_2023_perc <span class="sc">~</span> <span class="fu">s</span>(change), <span class="at">data =</span> df_gam_w)</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>reg1_gam_m <span class="ot">&lt;-</span> <span class="fu">gam</span>(diff_2007_2023_perc <span class="sc">~</span> <span class="fu">s</span>(change), <span class="at">data =</span> df_gam_m)</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>reg1_gam_p <span class="ot">&lt;-</span> <span class="fu">gam</span>(diff_2007_2023_perc <span class="sc">~</span> <span class="fu">s</span>(change), <span class="at">data =</span> df_gam_p)</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>reg1_gam_f <span class="ot">&lt;-</span> <span class="fu">gam</span>(diff_2007_2023_perc <span class="sc">~</span> <span class="fu">s</span>(change), <span class="at">data =</span> df_gam_f)</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>sum_gam_w <span class="ot">&lt;-</span> <span class="fu">summary</span>(reg1_gam_w)<span class="sc">$</span>s.table[<span class="st">"s(change)"</span>, ]</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>sum_gam_m <span class="ot">&lt;-</span> <span class="fu">summary</span>(reg1_gam_m)<span class="sc">$</span>s.table[<span class="st">"s(change)"</span>, ]</span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>sum_gam_p <span class="ot">&lt;-</span> <span class="fu">summary</span>(reg1_gam_p)<span class="sc">$</span>s.table[<span class="st">"s(change)"</span>, ]</span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>sum_gam_f <span class="ot">&lt;-</span> <span class="fu">summary</span>(reg1_gam_f)<span class="sc">$</span>s.table[<span class="st">"s(change)"</span>, ]</span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>gam1_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">Term =</span> <span class="st">"Potential Yield Change (s(change))"</span>,</span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">Wheat =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f (p=%.3f)"</span>, sum_gam_w[<span class="st">"edf"</span>], sum_gam_w[<span class="st">"p-value"</span>]),</span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">Maize =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f (p=%.3f)"</span>, sum_gam_m[<span class="st">"edf"</span>], sum_gam_m[<span class="st">"p-value"</span>]),</span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">Pea =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f (p=%.3f)"</span>, sum_gam_p[<span class="st">"edf"</span>], sum_gam_p[<span class="st">"p-value"</span>]),</span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">Flax =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f (p=%.3f)"</span>, sum_gam_f[<span class="st">"edf"</span>], sum_gam_f[<span class="st">"p-value"</span>])</span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(gam1_results, <span class="at">format =</span> <span class="st">"markdown"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 35%">
<col style="width: 17%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Term</th>
<th style="text-align: left;">Wheat</th>
<th style="text-align: left;">Maize</th>
<th style="text-align: left;">Pea</th>
<th style="text-align: left;">Flax</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Potential Yield Change (s(change))</td>
<td style="text-align: left;">5.598 (p=-0.000)</td>
<td style="text-align: left;">1.000 (p=0.267)</td>
<td style="text-align: left;">1.724 (p=0.205)</td>
<td style="text-align: left;">7.135 (p=0.000)</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="dependent-variable-mean-acreage-variations-between-2023-and-2007" class="level3">
<h3 class="anchored" data-anchor-id="dependent-variable-mean-acreage-variations-between-2023-and-2007">Dependent variable : mean acreage variations between 2023 and 2007</h3>
<p>We compute the mean variations over four years at the beginning and at the end of the period of interest (between 2007 and 2011, between 2019 and 2023). Then we take the percentage change in acreage between those two means, which will consist in our dependent variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OLS results with potential yield change as main explanatory variable</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>reg4_wheat <span class="ot">&lt;-</span> <span class="fu">feols</span>(diff_final_debut_perc <span class="sc">~</span> change<span class="sc">*</span>value_hist <span class="sc">|</span> region_code, <span class="at">data =</span> df_final_w)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 4,793 observations removed because of NA and infinite values (LHS: 4,749, RHS: 214).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>reg4_maize <span class="ot">&lt;-</span> <span class="fu">feols</span>(diff_final_debut_perc <span class="sc">~</span> change<span class="sc">*</span>value_hist <span class="sc">|</span> region_code, <span class="at">data =</span> df_final_m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 7,372 observations removed because of NA and infinite values (LHS: 6,470, RHS: 2,434).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>reg4_pea <span class="ot">&lt;-</span> <span class="fu">feols</span>(diff_final_debut_perc <span class="sc">~</span> change<span class="sc">*</span>value_hist <span class="sc">|</span> region_code, <span class="at">data =</span> df_final_p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 32,890 observations removed because of NA and infinite values (LHS: 32,886, RHS: 284).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>reg4_flax <span class="ot">&lt;-</span> <span class="fu">feols</span>(diff_final_debut_perc <span class="sc">~</span> change<span class="sc">*</span>value_hist <span class="sc">|</span> region_code, <span class="at">data =</span> df_final_f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 30,544 observations removed because of NA and infinite values (LHS: 30,540, RHS: 235).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>reg4_results <span class="ot">&lt;-</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modelsummary</span>(</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"Wheat"</span> <span class="ot">=</span> reg4_wheat, </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Maize"</span> <span class="ot">=</span> reg4_maize, </span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Pea"</span> <span class="ot">=</span> reg4_pea, </span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Flax"</span> <span class="ot">=</span> reg4_flax), </span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">stars =</span> <span class="cn">TRUE</span>,</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="st">"std.error"</span>,</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_map =</span> <span class="fu">c</span>(<span class="st">"change"</span> <span class="ot">=</span> <span class="st">"Potential Yield Change"</span>, </span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>               <span class="st">"value_hist"</span> <span class="ot">=</span> <span class="st">"Historical Yield"</span>,</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"change:value_hist"</span> <span class="ot">=</span> <span class="st">"Interaction"</span>),</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"markdown"</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(reg4_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
+------------------------+-----------------+-----------------+-----------------+-----------------+
|                        | Wheat           | Maize           | Pea             | Flax            |
+========================+=================+=================+=================+=================+
| Potential Yield Change | -3.520          | -4.734          | -387.587+       | -414.998        |
+------------------------+-----------------+-----------------+-----------------+-----------------+
|                        | (10.072)        | (4.472)         | (179.799)       | (255.479)       |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| Historical Yield       | -0.002          | -0.010*         | 0.044           | -0.170+         |
+------------------------+-----------------+-----------------+-----------------+-----------------+
|                        | (0.002)         | (0.004)         | (0.051)         | (0.085)         |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| Interaction            | -0.015+         | -0.009+         | 0.309+          | 0.680           |
+------------------------+-----------------+-----------------+-----------------+-----------------+
|                        | (0.008)         | (0.005)         | (0.152)         | (0.473)         |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| Num.Obs.               | 30033           | 27454           | 1936            | 4282            |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| R2                     | 0.032           | 0.003           | 0.027           | 0.030           |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| R2 Adj.                | 0.032           | 0.002           | 0.020           | 0.027           |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| R2 Within              | 0.002           | 0.001           | 0.005           | 0.002           |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| R2 Within Adj.         | 0.002           | 0.000           | 0.003           | 0.001           |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| AIC                    | 412780.0        | 428180.5        | 32077.9         | 66637.5         |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| BIC                    | 412912.9        | 428312.0        | 32161.5         | 66732.9         |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| RMSE                   | 233.37          | 589.12          | 951.37          | 577.48          |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| Std.Errors             | by: region_code | by: region_code | by: region_code | by: region_code |
+------------------------+-----------------+-----------------+-----------------+-----------------+
| FE: region_code        | X               | X               | X               | X               |
+========================+=================+=================+=================+=================+
| + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001                                              |
+========================+=================+=================+=================+=================+ </code></pre>
</div>
</div>
<p>Compared to the previous specification, the current results yield similar but more stable estimates in terms of sign and significance. Most importantly, the interaction term between potential yield change and historical yield remains statistically significant for <strong>wheat, maize, and pea</strong>. However, the magnitude of the coefficients, especially for the potential yield change, tends to be smaller in this specification. For <strong>wheat</strong> and <strong>maize</strong>, where the effects are now insignificant and negative. For <strong>pea</strong> and <strong>flax</strong>, large coefficients on the potential yield change persist, but they remain imprecisely estimated. The historical yield variable maintains its negative and sometimes significant association (see <strong>maize and flax</strong>).</p>
</section>
</section>
<section id="land-share-models" class="level2">
<h2 class="anchored" data-anchor-id="land-share-models">Land-share models</h2>
<p>In the literature, we can find land-share models using fractional logit. The outcome variable is the land allocated to the production of a given crop over the total cultivated area.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>